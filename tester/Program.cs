using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Text;
using System.Threading;
using System.Threading.Tasks;
using DataMiner;

namespace tester
{
    class ThreadSafeInt
    {
        private object _lock = new object();
        private int _val = 0;
        public int Value
        {
            get
            {
                lock (_lock)
                {
                    return _val;
                }
            }

            set
            {
                lock (_lock)
                {
                    _val = value;
                }
            }
        }

        public static ThreadSafeInt operator ++(ThreadSafeInt x)
        {
            x.Value++;
            return x;
        }
    }

    public class LoaderWithTimeout2
    {
        private int _timeout = 15000;
        private bool _done = false;

        private void OnLoadComplete(object sender, DownloadStringCompletedEventArgs e)
        {
            if (e.Cancelled)
            {
                Console.WriteLine("Canceled");
                return;
            }

            if (e.Error == null)
            {
                _done = true;
                Console.WriteLine(e.Result);
            } 
            else
            {
                Logger.LogError(e.Error);
            }
        }

        public bool LoadUrl(Proxy p)
        {
            using (var client = new WebClient())
            {
                var proxy = new WebProxy(p.Url, p.Port);
                client.Proxy = proxy;

                client.Encoding = Encoding.UTF8;
                client.Headers.Add("User-Agent: Other");
                client.DownloadStringAsync(new Uri("https://www.airbnb.com"));

                client.DownloadStringCompleted += OnLoadComplete;

                var _before = DateTime.Now;
                while (true)
                {
                    if ((DateTime.Now - _before).TotalMilliseconds >= _timeout)
                    {
                        Console.WriteLine("Time elapsed: CANCELLING");
                        client.CancelAsync();
                        return false;
                    }

                    if (_done)
                    {
                        break;
                    }

                }
            }

            return true;
        }
        
    }

    class Program
    {
        static ProxyCache _cache = new ProxyCache();

        static ThreadSafeInt Attempts = new ThreadSafeInt();
        static ThreadSafeInt Success = new ThreadSafeInt();
        static ThreadSafeInt Fails = new ThreadSafeInt();

        static bool LoadUrl(Proxy p)
        {
            try
            {
                using (var client = new WebClient())
                {
                    var proxy = new WebProxy(p.Url, p.Port);
                    client.Proxy = proxy;

                    client.Encoding = Encoding.UTF8;
                    client.Headers.Add("User-Agent: Other");
                    var html = client.DownloadString("https://www.airbnb.com");
                }

                return true;
            }
            catch (Exception e)
            {
                return false;
            }
        }

        static void TestThread(int n)
        {
            Thread.Sleep(5000);
        }

        static void Main(string[] args)
        {
            /*Logger.LogToConsole = true;
            var loader = new LoaderWithTimeout();
            var p = new Proxy()
            {
                Url = "218.56.132.154",
                Port = 8080,
            };

            var result = loader.LoadUrl(p);
            Console.WriteLine("Result: " + result);*/

            /*Console.WriteLine("Start time: " + DateTime.Now);

            var r = new CityReader();
            var request = new CityRequest()
            {
                Name = "Saint-Petersburg",
                Country = "Russia",
                Date = DateTime.Now,
                StartLatitude = 59.79219567461983,
                EndLatitude = 60.04839774295754,
                StartLongitude = 29.818058044888858,
                EndLongitude = 30.817813904263858,
            };

            r.CheckCityStatus(request);

            Console.WriteLine("DONE. Time: " + DateTime.Now);*/


            /*var pm = new DataMiner.Program();
            pm.LogToConsole = true;
            pm.Run();
            Console.ReadLine();*/

            var data = @"62.37.237.15:8080
62.37.237.16:8080
81.196.104.85:443
83.231.34.133:3128
83.231.34.133:80
173.192.21.89:8123
173.192.21.89:25
125.16.240.197:8080
58.27.217.75:3128
177.184.8.123:80
200.29.191.149:3128
161.202.226.194:8123
161.202.226.194:8080
161.202.226.194:80
201.33.206.229:3128
220.133.248.20:80
83.231.34.132:3128
125.141.200.15:80
125.141.200.7:80
125.141.200.35:80
125.141.200.20:80
125.141.200.4:80
125.141.200.43:80
125.141.200.53:80
125.141.200.55:80
125.141.200.23:80
125.141.200.22:80
125.141.200.25:80
125.141.200.44:80
125.141.200.2:80
123.30.238.16:3128
163.28.112.100:3128
218.106.205.145:8080
186.27.126.130:80
177.55.158.18:3128
109.197.188.6:8080
37.59.37.41:3128
125.141.200.13:80
125.141.200.11:80
125.141.200.12:80
125.141.200.14:80
125.141.200.40:80
159.8.114.37:8123
159.8.114.37:25
185.28.193.95:8080
119.81.189.194:25
119.81.189.194:80
177.99.207.42:3128
223.68.1.38:8000
202.106.16.36:3128
119.81.189.194:8123
122.154.146.218:3128
210.101.131.231:8080
176.31.96.198:3128
101.255.51.47:8080
94.20.21.38:8888
220.248.229.45:3128
212.15.182.156:80
62.37.237.98:8080
62.37.237.25:8080
62.37.237.25:80
62.37.237.92:8080
62.37.237.35:8080
62.37.237.66:8080
62.37.237.62:8080
62.37.237.5:8080
62.37.237.34:8080
62.37.237.32:8080
62.37.237.18:8080
62.37.237.33:80
62.37.237.64:8080
62.37.237.97:8080
62.37.237.93:8080
62.37.237.33:8080
212.15.182.143:80
62.37.237.31:8080
62.37.237.61:8080
62.37.237.36:8080
62.37.237.91:8080
62.37.237.14:8080
62.37.237.72:8080
62.37.237.70:8080
62.37.237.68:8080
62.37.237.67:8080
62.37.237.87:8080
62.37.237.90:8080
62.37.237.101:8080
62.37.237.88:8080
62.37.237.89:8080
62.37.237.100:8080
62.37.237.32:80
107.21.56.41:3128
107.21.56.41:443
107.21.56.41:8080
54.187.52.159:80
54.187.52.159:443
54.187.52.159:8080
54.187.52.159:3128
52.69.20.245:8080
94.20.21.38:3128
54.179.166.238:8080
52.77.209.208:3128
54.179.166.238:80
54.179.166.238:443
220.248.230.217:3128
62.37.237.63:8080
156.17.55.11:443
176.31.96.198:8080
83.231.34.193:3128
109.197.188.20:8080
103.4.166.203:8080
210.101.131.229:8080
109.207.49.158:8080
63.150.152.151:3128
63.150.152.151:8080
120.24.73.165:3128
180.169.8.51:3128
1.82.216.135:80
109.207.49.174:8080
203.156.126.55:3129
187.44.1.167:8080
178.22.148.122:3129
118.98.216.122:8080
47.90.46.132:3128
81.181.81.27:3128
109.197.188.8:8080
103.254.106.60:8080
203.91.121.74:3128
122.155.3.143:3128
112.199.65.190:3128
187.44.1.54:8080
1.82.216.134:80
201.174.52.29:8080
1.9.171.51:800
89.185.7.252:8080
62.89.216.4:3128
177.126.81.50:3128
218.56.132.156:8080
203.83.176.28:8080
116.197.134.130:8080
109.207.49.190:8080
196.200.54.66:8080
109.197.188.9:8080
193.93.216.95:8080
46.37.193.74:3128
178.252.146.6:8080
213.82.17.244:3129
217.119.125.102:8081
85.70.104.25:8080
46.37.193.74:8080
176.106.145.122:8080
202.152.40.28:8080
182.253.236.74:8080
110.206.127.136:9797
218.56.132.154:8080
218.56.132.158:8080
218.56.132.157:8080
202.166.207.152:8080
117.102.100.5:8080
91.142.84.182:3128
200.167.191.227:9090
189.2.65.120:3128
41.186.24.69:3128
212.144.222.27:3128
109.197.188.25:8080
94.231.116.134:8080
46.105.214.133:3128
200.46.94.202:3128
138.36.106.18:3128
186.10.5.140:8080
123.7.115.141:9797
193.34.173.70:8080
80.191.214.114:8080
203.201.172.90:3128
113.53.230.199:3128
93.63.142.144:80
84.242.196.13:8080
218.92.227.165:20093
80.87.81.102:3128
109.196.34.51:8080
218.56.132.155:8080
109.207.51.177:8080
103.10.134.21:8080
218.92.227.165:24809
91.221.233.82:8080
78.108.108.9:8080
200.199.34.58:8080
218.92.227.165:33948
218.92.227.165:35010
117.176.62.148:3128
123.7.115.141:9999
200.195.167.26:8080
91.194.42.51:80
218.92.227.165:33965
218.92.227.165:18350
109.69.2.125:8080
218.92.227.165:33919
218.92.227.165:14856
218.92.227.165:34484
218.92.227.165:33925
80.87.33.134:8080
180.250.60.218:8080
41.207.49.136:8080
94.230.243.6:8080
91.247.250.209:8080
103.215.223.27:8080
195.244.36.177:8080
94.42.140.10:8080
218.92.227.165:15275
218.92.227.165:18943
218.92.227.165:16385
197.210.216.22:8080
103.240.8.2:8080
213.221.56.213:3128
218.232.109.137:8090
218.92.227.165:21571
5.189.176.106:80
160.202.42.10:8080
151.80.135.147:3128
190.128.173.118:3128
1.179.201.18:3128
83.221.208.217:8080
61.162.223.41:9797
101.64.239.195:8080
222.161.3.163:9999
160.202.42.250:8080
218.92.227.165:19327
46.10.223.92:8080
94.23.196.68:3128
218.92.227.165:18186
218.92.227.165:18888
218.92.227.165:34034
173.201.183.172:8000
185.36.60.68:8080
190.214.49.4:8080
92.60.126.169:3128
185.101.230.115:8080
218.92.227.165:33944
195.116.7.10:8080
218.92.227.165:18253
1.179.194.41:8080
185.84.107.19:8080
115.231.16.138:8080
190.15.195.52:8080
82.151.117.162:8080
218.92.227.165:17945
195.189.249.105:8080
49.1.244.139:3128
83.241.46.175:8080
187.16.253.74:3128
41.205.231.202:8080
218.92.227.165:32844
186.219.106.4:8080
218.92.227.165:15238
36.66.212.59:8080
60.21.209.114:8080
218.92.227.165:33719
95.161.228.186:8080
109.207.53.34:8080
188.128.122.118:8080
218.92.227.165:14826
122.155.222.98:3128
218.92.227.165:10174
160.202.42.66:8080
31.25.137.235:8080
87.249.205.103:8080
109.224.54.18:8080
218.92.227.165:34061
218.92.227.165:11825
176.106.126.233:8080
91.243.163.202:8080
91.108.131.250:8080
46.10.220.64:8080
190.52.175.76:3128
195.46.167.164:5555
88.87.72.72:8080
195.228.182.143:8080
41.222.234.58:8080
178.255.175.222:8080
46.35.188.7:8080
101.254.188.198:8080
124.239.177.85:8080
218.92.227.165:12946
180.148.211.203:8080
218.92.227.165:18204
218.92.227.165:12640
176.12.125.198:8080
188.0.183.146:8080
91.237.150.68:8080
218.92.227.165:12945
218.92.227.165:33942
31.199.181.130:8080
218.92.227.165:16515
218.92.227.165:19329
109.207.49.250:8080
80.77.29.22:80
218.92.227.165:13063
59.175.238.41:443
46.16.226.10:8080
160.202.41.106:8080
218.92.227.165:10080
190.104.178.46:8080
178.215.111.70:9999
58.67.159.50:80
187.160.245.156:3128
218.92.227.165:20771
218.92.227.165:19305
188.231.149.119:8080
82.119.86.58:80
82.201.134.150:8080
82.146.37.33:8888
37.235.24.47:8080
41.79.60.202:8080
95.78.172.184:8080
85.204.229.47:81
103.24.127.197:8080
123.5.57.136:9999
101.64.239.138:8080
197.210.246.30:8080
94.180.115.22:8080
109.207.49.46:8080
160.202.42.43:8080
90.154.127.19:8000
37.233.59.6:8080
115.249.2.192:8080
218.92.227.165:10030
188.165.79.184:9999
181.40.78.174:3128
103.28.149.118:8000
27.131.47.132:9797
179.111.208.144:3128
202.29.221.90:3128
202.21.181.110:3128
177.128.193.114:8089
177.55.253.68:8080
213.168.37.86:8080
185.13.228.124:8080
41.160.118.226:8080
186.10.5.138:8080
177.71.17.70:8080
186.10.5.141:8080
218.92.227.165:12638
77.240.245.130:8080
46.219.116.2:8081
218.92.227.165:12483
196.41.123.151:80
115.231.16.175:8080
177.103.182.12:3128
87.251.142.208:8080
124.155.112.85:80
46.218.85.101:3129
119.52.11.14:9999
46.49.67.56:8080
218.92.227.165:13669
203.160.172.163:8090
80.188.79.138:8080
92.255.187.219:8080
164.132.28.157:3128
103.230.222.134:8080
80.87.81.102:80
91.241.20.170:3128
218.29.111.106:9797
165.193.231.226:3128
95.215.52.150:8080
113.11.87.186:8080
200.10.67.164:8080
92.62.225.4:8888
193.86.229.230:8080
80.245.115.61:8080
113.108.141.98:9797
109.207.53.46:8080
46.231.214.166:8080
177.87.45.74:8080
176.192.63.162:8080
89.41.106.99:8080
41.79.137.248:8080
122.228.179.178:80
190.214.48.125:8080
91.144.170.31:8080
200.68.27.100:3128
197.254.106.226:8080
103.18.4.13:9000
190.221.23.158:80
112.133.200.202:8080
31.131.67.76:8080
115.85.76.242:8080
195.209.107.148:3128
217.172.120.18:8080
202.153.228.130:8080
197.220.198.110:8080
91.221.178.222:8080
81.18.214.62:8080
27.131.15.210:8080
124.160.225.37:3128
115.124.78.54:80
178.249.59.251:8080
41.222.117.163:8080
95.171.198.206:8080
213.111.123.68:8080
173.192.21.89:80
189.202.216.137:8080
37.233.57.250:8080
62.220.59.105:8080
41.160.223.252:8080
182.253.202.122:8080
85.133.184.211:8080
37.236.148.243:80
187.18.123.47:3128
180.250.74.210:8080
37.236.148.243:8080
103.246.17.237:3128
186.24.33.213:3128
146.52.84.73:8080
160.202.42.114:8080
110.170.20.62:8080
157.100.180.14:8080
212.200.99.130:8080
190.151.10.226:8080
103.9.115.142:3128
109.230.112.2:9090
41.215.7.94:8080
96.9.69.200:8080
41.161.78.165:8080
103.5.203.242:8080
123.138.73.122:9797
202.118.8.13:3128
202.182.51.138:80
159.8.114.37:80
185.104.193.42:8080
92.38.126.149:8080
91.98.143.85:8080
118.189.157.9:3128
188.138.195.178:8080
115.127.10.130:8080
101.251.199.66:3128
160.202.41.18:8080
47.88.6.158:8118
104.131.75.65:80
123.138.73.122:9999
114.31.9.146:8080
190.15.222.55:8080
27.123.1.58:8080
46.19.231.50:8080
182.160.102.146:3128
88.211.126.138:8080
213.192.31.173:8080
180.234.217.27:8080
94.47.255.26:8080
121.40.108.76:80
217.12.121.86:80
202.148.4.26:8080
116.212.183.186:8080
190.183.61.157:8080
197.149.179.181:8888
186.139.62.150:8080
191.7.213.181:8080
128.199.169.17:80
91.217.42.2:8080
202.152.62.170:8080
189.85.20.21:8080
177.22.111.113:3128
201.132.162.38:8080
124.89.35.206:9999
160.202.42.210:8080
183.87.127.97:8080
31.146.182.122:443
41.33.22.186:8080
150.188.232.243:80
31.25.141.148:8080
61.153.145.202:25
184.69.67.122:80
213.80.130.210:80
91.243.163.170:8100
107.17.100.254:8080
89.108.165.187:8080
191.102.89.54:3128
204.16.100.100:8080
160.202.42.106:8080
101.255.60.126:80
41.169.16.202:8080
185.61.183.246:8080
159.255.167.131:8080
217.150.40.189:3128
221.228.197.28:8080
84.22.35.37:3129
109.207.60.161:8080
122.224.227.202:3128
190.18.134.27:8080
213.198.241.6:8080
162.223.88.243:80
201.47.62.130:6666
217.75.204.6:8080
91.98.143.85:80
200.43.77.19:8080
200.223.91.58:3128
217.24.254.115:8080
200.68.83.249:3129
118.97.239.146:8080
177.39.186.59:8008
91.239.11.235:3128
61.19.193.211:80
189.202.216.137:80
114.6.67.228:8080
93.64.156.3:80
202.108.2.42:80
91.217.42.3:8080
196.11.90.57:8080
158.181.18.158:8080
103.30.90.206:8080
180.211.179.50:8080
185.40.150.3:8080
85.185.238.214:8080
71.8.234.210:8080
125.253.32.158:3128
36.80.34.225:3128
195.34.238.154:8080
58.84.15.241:8080
213.221.8.55:8080
130.193.116.106:8080
125.209.97.190:8080
37.235.65.76:8080
192.99.246.101:8118
197.210.185.246:3128
179.111.242.56:3128
109.207.54.81:8080
201.151.151.222:8080
222.41.113.43:8080
87.244.181.185:8080
62.220.55.27:8080
122.52.133.5:8080
200.17.131.149:8080
190.52.185.218:8080
139.255.75.98:8080
123.176.102.77:8080
182.23.115.90:8080
84.22.35.34:3129
96.87.48.211:8080
103.228.246.8:8080
43.231.23.101:8080
101.255.62.202:80
216.241.14.94:8080
218.92.227.173:19305
110.36.218.2:8080
115.124.73.122:80
200.192.248.74:8080
41.212.73.2:3128
115.46.88.84:8080
181.229.140.11:8085
202.152.20.114:8080
103.234.137.244:3128
85.105.177.187:8080
185.31.218.42:8080
31.47.97.100:8080
181.49.44.14:8080
160.202.40.218:8080
177.86.24.194:8080
117.102.77.34:3128
183.82.109.189:8080
95.170.222.106:8080
177.5.219.112:8080
37.57.179.2:8080
202.166.205.85:8080
41.188.49.159:8080
103.5.203.242:80
200.58.149.178:8080
116.68.206.122:8080
203.202.251.42:8080
111.40.84.73:9797
46.32.2.98:8080
197.210.252.39:8080
196.44.185.109:8080
190.82.94.13:80
197.232.2.247:8080
89.135.121.1:3128
119.29.232.113:3128
114.215.150.13:3128
192.140.223.94:8080
154.73.220.137:8080
45.40.143.57:80
124.47.7.45:80
119.40.98.162:8080
223.25.102.186:8080
194.154.74.210:8080
114.5.12.178:8080
190.82.117.18:8080
203.202.251.42:80
91.202.144.14:8080
201.55.143.250:3128
49.236.216.244:8080
173.68.185.170:80
112.74.207.196:3128
41.160.187.186:3128
202.43.190.11:8118
193.194.87.227:8080
180.250.182.50:8080
80.240.221.38:3128
177.43.72.251:3128
40.113.118.174:8118
124.128.221.27:8080
103.15.60.21:8080
5.2.243.134:8080
217.170.23.52:3128
113.200.29.10:9999
36.66.218.19:3128
186.67.136.34:8080
60.174.237.43:9999
46.188.55.42:8080
202.29.233.110:3128
85.10.53.90:8080
203.112.79.22:8080
202.141.248.130:8080
5.53.16.183:8080
119.135.185.99:9797
222.124.35.115:3128
201.55.143.1:3128
103.48.112.130:8080
189.206.30.82:1234
103.242.46.172:8080
123.49.34.3:8080
180.250.243.67:8080
203.128.75.14:8080
210.211.18.140:808
86.102.106.150:8080
200.192.214.138:8080
61.19.193.211:8080
200.205.13.82:8080
92.49.3.49:8080
200.108.35.60:8088
178.19.98.1:8088
58.96.182.226:3128
218.92.227.171:33925
78.46.65.99:8080
101.255.76.50:80
103.52.135.202:8080
41.220.28.138:8080
88.170.1.143:8118
176.114.125.203:8080
5.189.135.39:3128
61.247.186.138:8080
218.92.227.173:13669
218.92.227.173:18186
222.124.219.210:3128
114.79.163.162:8080
177.8.216.106:8080
177.189.240.163:3128
218.92.227.171:29037
118.69.205.201:4624
115.248.109.90:3128
207.5.112.114:8080
189.124.25.90:3128
109.69.2.35:8080
190.121.158.122:8080
190.131.252.102:8080
46.243.179.1:80
182.253.209.203:3128
186.250.157.22:8080
154.73.222.11:8080
118.97.127.58:8080
83.239.29.234:8080
187.32.4.66:8080
186.67.152.250:3128
1.179.198.17:8080
1.179.198.37:8080
218.92.227.171:35010
200.241.72.226:8080
82.209.49.200:8080
137.135.166.225:8131
186.56.82.232:80
131.255.153.252:3128
36.66.34.10:8080
218.22.65.60:60088
218.92.227.171:33965
101.255.60.2:80
186.10.5.142:8080
41.79.37.74:8585
218.92.227.171:18888
219.232.125.232:3128
218.92.227.173:15692
122.53.51.95:8080
60.250.81.97:80
190.185.165.225:3128
218.92.227.171:10000
176.194.189.56:8080
193.34.13.188:8080
143.255.109.90:8080
81.219.211.233:8080
180.250.207.162:8080
79.174.160.162:8080
218.92.227.171:23245
5.39.89.84:8080
197.243.50.242:3129
115.124.75.30:80
84.22.46.25:8080
190.248.135.134:8080
103.250.185.3:1518
84.10.40.158:8080
190.189.237.106:8080
201.20.109.42:3128
177.207.234.14:80
180.149.98.206:8080
80.250.62.2:8080
103.9.115.161:3128
86.100.118.44:80
81.219.211.1:8080
203.130.192.179:3128
188.253.51.30:8080
148.240.155.168:8080
190.3.117.90:8080
103.206.246.110:8080
51.254.86.25:80
218.92.227.171:33719
77.241.18.10:8080
212.91.189.166:8000
177.38.207.17:8080
120.85.132.234:80
185.21.76.34:8080
186.153.3.250:3128
218.92.227.173:21724
190.15.222.53:8080
181.211.246.18:8080
202.152.39.66:8080
77.76.134.120:8080
27.131.47.132:8080
91.227.77.1:1234
185.21.76.37:8080
103.48.112.106:8080
218.92.227.171:18256
160.202.42.58:8080
88.199.173.233:8080
46.225.239.178:8080
125.209.110.187:80
119.252.160.34:8080
119.252.172.133:3128
47.88.14.58:3128
190.248.153.162:8080
154.72.48.214:8080
103.251.83.49:8080
80.237.79.1:3128
197.211.45.4:8080
43.241.246.40:8080
124.40.246.229:8080
175.100.97.41:8080
212.16.65.74:8080
177.69.195.4:8080
82.209.49.196:8080
181.211.191.227:8080
212.72.133.174:8080
43.225.23.26:8080
177.21.10.90:8080
220.249.185.178:9797
110.50.84.59:8080
46.209.213.210:8080
117.58.247.198:8080
182.253.6.234:8080
82.112.62.57:8080
207.188.73.155:80
103.242.45.68:8080
81.133.175.188:80
105.112.6.37:8080
182.253.19.90:8080
4.31.35.110:8080
1.179.183.86:8080
218.92.227.171:18186
115.127.72.90:8080
189.16.249.114:8080
41.78.88.182:8080
111.90.189.118:8080
36.71.104.102:8080
103.10.52.200:8080
197.220.100.118:8080
88.208.238.110:3128
137.135.166.225:8119
36.81.255.73:8080
111.40.84.73:9999
191.98.183.139:8080
137.135.166.225:8136
112.78.149.178:8080
77.46.215.126:8080
180.250.84.170:3128
177.200.82.236:8080
202.137.25.53:3128
80.68.2.101:8080
41.188.49.210:8080
103.56.30.78:8080
51.254.86.25:8080
177.86.0.156:8080
180.250.46.227:8080
106.186.22.65:8888
221.214.221.148:3128
137.135.166.225:8125
80.188.135.10:8080
190.216.6.2:8080
219.166.7.50:80
181.143.51.106:8080
163.28.80.40:3128
177.152.174.141:8080
163.28.80.40:80
111.177.124.140:9797
221.176.153.94:9000
181.40.84.194:8080
188.93.133.211:8080
212.12.31.26:8080
82.107.202.30:8080
197.215.220.254:8080
222.124.129.179:8080
86.62.113.212:443
203.83.165.134:8080
31.173.3.175:8000
94.229.247.57:8080
41.78.88.178:8080
190.121.158.114:8080
137.135.166.225:8147
41.76.44.76:3128
197.232.43.41:8080
189.213.65.99:3128
222.124.146.81:8080
81.219.208.1:8080
77.73.104.62:80
101.255.60.122:80
91.187.110.69:8080
137.135.166.225:8127
83.167.82.58:8888
168.63.24.174:8134
36.84.90.16:8080
149.56.35.226:80
180.250.100.66:3128
62.80.178.146:8080
110.78.161.106:8080
41.33.182.195:8080
181.60.253.71:8080
106.37.234.91:443
41.210.167.62:8080
91.196.230.66:3128
168.63.24.174:8137
117.102.127.186:8080
1.179.183.93:8080
117.158.1.210:9797
41.93.146.18:8080
190.248.27.20:3128
81.219.209.1:8080
198.23.143.27:8080
139.0.28.18:8080
1.179.146.153:8080
119.254.84.90:80
46.243.179.241:80
177.190.209.10:8080
218.92.227.171:17945
103.26.192.163:8080
81.219.211.225:8080
31.173.3.175:8080
81.219.211.249:8080
190.29.22.247:8080
139.0.22.118:8080
173.10.253.25:8080
1.179.183.109:8080
200.76.251.166:3128
198.23.74.170:81
125.31.1.25:80
41.188.56.105:8080
61.19.82.138:8080
146.88.71.69:8080
152.160.35.171:80
187.86.137.222:3128
103.251.83.62:8080
137.135.166.225:8121
212.174.6.68:3128
60.250.81.118:8080
119.235.50.182:8080
202.147.206.114:8080
183.131.151.208:80
1.179.185.249:8080
187.60.47.46:8080
218.75.144.25:9000
95.171.198.220:8080
180.153.87.22:18080
82.102.14.187:8080
43.250.82.222:8080
191.5.114.138:8080
43.243.142.130:8080
220.249.185.178:9999
189.213.65.108:3128
1.179.185.253:8080
190.147.208.143:8080
80.240.101.6:8000
101.255.51.146:3128
62.81.76.18:8080
160.202.42.98:8080
182.225.165.184:3128
160.202.41.138:8080
188.168.26.0:8080
114.79.163.161:8080
146.185.149.184:3128
103.245.77.56:8080
5.56.12.26:8080
70.90.16.115:8080
177.103.138.75:8081
112.142.130.19:8080
70.169.24.2:8080
181.48.211.210:8080
92.104.19.217:3128
121.14.9.76:80
59.90.100.57:8080
36.77.2.136:8080
103.36.35.106:8080
80.72.225.179:8080
123.30.75.115:80
202.141.250.25:8080
168.63.20.19:8120
118.97.32.226:8080
41.33.191.116:8080
202.141.250.173:8080
138.0.23.222:8080
168.63.24.174:8127
163.53.187.98:8080
187.190.248.173:3128
103.206.246.150:8080
115.70.208.154:8080
24.39.59.197:8080
27.111.45.12:8080
190.6.34.234:8080
190.121.138.162:8080
85.114.206.63:3128
223.27.194.66:8080
41.168.20.85:80
36.37.81.130:8080
119.29.103.13:8888
46.209.216.107:8080
188.93.246.185:8080
47.88.8.215:8118
41.204.93.54:8080
110.77.149.88:8080
114.57.31.210:8080
47.90.4.23:3128
123.108.14.94:80
117.158.1.210:9999
123.30.75.115:443
149.202.34.104:3128
191.253.65.106:8080
75.150.203.77:8118
138.68.30.235:8088
186.103.169.164:8080
111.118.150.4:8080
201.57.249.10:8080
202.171.171.57:8080
50.30.152.130:8086
109.201.177.164:8080
187.60.170.22:3128
92.222.108.217:3128
37.25.111.3:3128
45.64.195.142:8080
80.179.196.126:8088
185.21.76.35:8080
45.64.136.246:8080
178.34.176.86:8080
5.56.12.9:8080
82.114.82.60:8080
105.112.4.194:8080
103.15.62.69:8080
183.91.87.36:3128
5.200.72.154:8080
203.189.130.125:8080
89.231.21.19:8080
114.212.160.2:80
113.200.159.155:9999
5.9.117.85:8118
189.202.220.195:80
122.227.171.22:9999
200.94.79.110:3128
181.41.219.69:9999
115.127.92.130:8080
117.239.96.43:3128
36.77.0.241:8080
158.181.25.86:8080
201.38.196.50:3128
2.185.149.99:8080
121.8.170.53:9797
45.123.41.86:8080
119.18.152.52:3129
223.165.7.122:8080
189.213.65.98:3128
200.105.148.74:8080
41.221.76.9:8080
27.122.12.45:3128
77.73.104.18:3128
187.87.202.194:8080
36.66.76.177:3128
186.249.7.202:8080
168.63.24.174:8124
121.14.9.76:110
105.112.0.186:8080
212.233.230.196:8080
80.188.135.11:8080
178.217.113.62:8080
113.161.68.146:8080
84.52.86.5:3128
137.135.166.225:8128
61.134.25.106:3128
190.144.241.197:3128
181.39.148.3:8080
103.4.250.18:9090
202.21.191.102:8080
5.56.12.13:8080
195.93.129.10:62000
201.163.214.218:8080
137.135.166.225:8124
189.84.222.125:8080
177.136.115.162:666
118.180.7.30:9000
197.220.193.137:443
139.255.40.130:8080
40.114.5.134:8118
137.135.166.225:8141
121.41.110.73:8080
210.57.214.46:3128
43.240.100.211:8080
200.70.43.146:8080
218.241.234.48:8080
118.97.191.205:8080
181.49.105.68:8080
180.250.212.242:8080
104.245.69.26:3128
103.18.180.94:8080
187.189.81.21:8080
118.174.38.155:8080
222.165.135.198:3128
195.246.57.154:8080
163.47.147.34:8080
41.79.170.33:8080
178.161.130.10:3128
123.30.75.115:3128
110.37.217.252:8080
49.231.150.233:3128
78.187.73.210:8080
184.49.233.234:8080
5.135.176.41:3123
221.141.2.52:8080
212.227.159.39:80
110.36.172.112:8080
203.156.123.222:8080
103.28.225.180:8080
186.103.169.162:8080
36.85.91.95:8080
125.162.140.49:80
74.85.156.50:8090
92.222.107.60:3128
94.200.231.130:8080
222.124.34.189:8080
5.40.227.209:8080
190.181.18.232:8080
12.205.66.66:8080
92.222.108.124:3128
211.21.221.8:3128
107.170.213.149:3128
41.204.87.25:8080
159.253.80.30:808
195.228.210.245:8080
113.161.180.101:8080
116.90.208.131:8080
200.105.148.74:80
218.6.145.11:9797
124.207.82.166:8008
163.53.186.50:8080
113.10.214.213:3123
187.217.189.229:8081
110.170.167.59:8080
103.30.182.138:8080
137.135.166.225:8122
169.57.157.148:25
169.57.157.148:8123
169.57.157.148:80
96.9.90.54:8080
217.150.38.177:8000
183.91.87.34:3128
195.158.139.46:8000
200.87.192.35:80
178.189.92.118:3129
197.210.252.40:8080
182.253.191.131:8080
83.142.165.162:8080
202.154.188.248:8080
105.112.6.26:8080
78.38.116.210:8080
103.205.134.178:8080
58.59.68.91:9797
190.146.21.123:8080
180.250.149.73:8080
41.204.87.29:8080
188.132.226.242:3128
82.99.202.163:808
81.218.208.175:8088
178.48.1.117:8080
177.19.238.67:8080
115.70.186.106:8080
176.31.99.80:2222
46.101.215.222:8118
87.255.241.235:8080
92.222.104.202:3128
80.240.101.10:8000
1.179.183.89:8080
213.171.13.41:8080
218.241.153.211:81
1.254.195.253:8080
195.178.56.32:8080
183.131.76.27:8888
95.213.194.94:3128
202.154.187.17:8080
123.52.130.3:9999
139.0.23.114:8080
41.75.67.173:8080
2.179.192.36:8080
80.240.104.17:8000
177.136.85.122:8080
110.73.182.12:9000
195.112.199.221:8080
177.69.52.192:3128
202.27.212.138:8080
201.213.54.47:3128
218.90.174.167:3128
168.63.20.19:8132
124.40.246.193:8080
80.64.105.3:8080
186.250.96.66:8080
202.21.116.13:3128
88.208.238.203:3128
177.43.243.107:8080
113.11.133.202:8080
123.65.217.151:9797
46.164.141.173:8080
46.227.48.109:8080
181.199.170.251:3128
80.245.117.130:8080
121.40.203.107:8088
221.237.154.57:9797
220.247.166.148:8080
5.135.204.122:3128
120.29.159.146:8080
220.130.196.155:80
160.202.41.130:8080
119.105.177.105:8118
114.6.34.194:8080
103.224.186.2:8080
114.141.91.206:8080
180.183.247.160:8080
103.14.27.134:8080
198.12.158.169:8080
47.88.12.78:8118
177.185.32.1:8080
109.104.165.213:8080
80.75.85.42:3128
103.4.167.230:8080
111.11.98.58:9000
195.9.6.50:8080
62.165.42.170:8080
62.84.66.39:120
118.70.128.7:8080
181.211.102.82:8080
68.38.88.142:8080
222.80.72.30:1337
45.64.166.142:8080
5.135.204.121:3128
113.28.132.225:8000
131.161.45.17:8080
209.133.66.212:8080
131.221.43.82:8080
186.225.52.57:8080
50.42.43.26:8080
189.84.61.1:8080
116.50.31.18:8989
27.131.157.214:8080
212.100.130.98:8000
121.40.203.107:80
92.222.154.59:3128
202.51.188.154:8080
112.213.94.36:3128
138.204.68.58:8080
103.14.26.150:8080
115.127.92.132:8080
66.122.95.218:8080
113.108.253.195:9797
92.222.106.131:3128
190.121.231.114:8080
92.222.109.41:3128
119.254.88.53:8080
195.94.29.10:8080
92.222.108.238:3128
92.222.109.42:3128
31.163.202.59:8080
104.41.154.213:8118
195.138.86.112:3128
139.196.140.9:80
41.38.139.34:8080
124.105.43.194:80
115.160.137.178:8088
79.140.20.98:8080
186.103.193.51:8080
88.225.232.158:8080
195.24.205.153:8080
94.136.95.150:8080
122.154.33.201:8080
61.143.158.238:808
187.87.202.196:8080
46.253.135.237:8080
59.90.111.127:8080
109.121.146.159:8080
180.214.247.90:8080
137.135.166.225:8130
193.150.121.66:4444
203.142.81.202:8080
114.6.34.197:8080
115.183.11.158:9999
200.66.94.148:8080
177.189.244.117:3128
190.76.125.122:8080
210.4.97.107:3128
101.231.46.34:8000
212.200.126.13:8080
172.245.29.54:8118
36.81.253.196:3128
58.215.12.86:80
46.101.7.133:8118
109.194.18.181:3128
203.128.71.178:80
209.45.67.52:8080
137.135.166.225:8126
1.179.143.178:3128
1.9.170.114:8080
92.222.154.47:3128
190.0.60.130:8080
112.78.178.12:8080
36.78.220.190:8080
78.8.195.131:8080
155.232.186.14:3128
212.253.104.149:3128
202.59.163.129:8080
41.210.168.14:8080
86.100.118.44:81
202.71.24.193:8080
190.104.246.162:8080
202.58.199.182:8080
103.234.26.10:8080
202.90.68.50:80
60.191.134.162:9999
104.40.159.62:8118
111.177.124.144:9797
103.18.80.1:8080
118.97.24.178:8080
94.139.204.185:8080
12.41.141.10:8080
78.39.101.186:8080
61.19.51.51:8080
115.69.217.10:3128
181.143.9.91:8080
110.232.76.210:8080
41.78.88.142:8080
117.121.231.241:8080
185.120.197.140:80
188.38.105.39:8080
181.36.5.138:3128
168.63.20.19:8137
195.138.85.137:8080
107.170.237.191:8000
92.222.107.48:3128
168.63.24.174:8143
5.56.12.10:8080
1.9.170.130:8080
175.100.72.95:8080
62.219.227.245:8088
43.250.83.158:8080
92.222.107.49:3128
120.197.57.244:8000
92.222.108.111:3128
190.203.211.238:8080
87.116.201.201:8080
103.234.26.65:8080
122.154.71.49:8080
186.229.144.146:8080
197.164.68.16:8080
202.47.112.242:8080
69.50.57.34:8080
107.170.237.191:8080
202.162.200.164:80
62.241.149.172:8080
115.127.92.131:8080
88.199.164.133:8080
46.101.22.228:8118
111.177.124.144:9999
106.186.121.123:25
54.255.211.131:8118
94.181.46.201:3128
115.183.11.158:9797
62.84.66.39:8998
154.127.68.193:8080
222.185.229.56:80
121.12.120.246:2008
178.62.89.92:8118
77.232.185.168:8080
103.18.180.50:8080
103.28.225.169:8080
120.204.85.29:3128
195.182.141.2:3128
114.141.93.208:8080
176.123.129.14:8080
196.205.203.100:8080
193.242.144.200:8080
183.81.158.24:8080
88.157.149.250:8080
82.146.52.210:8118
80.245.117.132:8080
92.222.108.118:3128
200.5.253.234:80
110.164.197.124:8080
202.78.206.70:8080
80.245.117.134:8080
109.197.116.97:3128
116.90.211.140:8080
81.21.75.142:8083
179.217.26.134:3128
177.54.106.153:8082
212.142.74.184:21320
190.202.186.205:8080
103.24.212.53:8080
178.62.88.50:8118
190.198.1.6:8080
36.78.179.76:8888
31.3.190.93:8080
177.8.23.106:3128
79.175.28.102:8081
122.154.66.193:8080
175.100.73.108:8080
186.93.132.74:8080
103.14.26.18:8080
117.121.231.230:8080
186.93.138.97:8080
103.5.187.34:8080
36.80.33.247:8080
104.245.69.17:3128
190.74.216.45:8080
199.168.100.34:8123
190.199.133.231:3128
179.108.39.129:8080
36.66.76.180:3128
112.90.159.146:8888
85.43.201.190:3128
92.222.107.175:3128
190.14.248.82:8080
117.164.101.211:8123
186.90.74.99:8080
180.183.255.193:8080
181.177.231.250:8080
190.78.20.135:8080
186.250.96.1:8080
92.222.109.33:3128
177.128.225.193:8080
77.50.220.92:8080
112.140.186.170:808
91.134.221.52:80
222.124.176.18:3128
139.196.51.232:3128
186.233.44.173:8080
203.130.205.169:3128
83.218.162.30:8080
200.5.226.118:3128
36.66.43.181:8080
85.9.129.74:80
200.115.28.129:8080
116.50.29.193:8989
122.255.120.250:8080
109.197.116.9:3128
114.141.93.208:80
36.71.131.10:8080
180.250.196.82:8080
109.248.236.91:8080
107.170.237.191:80
108.208.26.71:3128
150.107.149.56:8080
177.136.113.1:666
92.222.153.211:3128
117.158.206.44:9797
27.116.20.185:8080
177.223.50.94:3128
222.124.195.130:8080
36.77.3.73:8080
178.161.132.78:8080
198.2.202.33:80
103.49.189.14:80
116.9.156.105:3123
198.2.202.33:8090
103.25.182.1:8081
202.78.206.81:8080
82.80.144.132:8088
210.51.2.203:8089
188.228.185.3:8080
187.49.92.34:6006
195.207.46.25:8080
189.202.187.68:3128
49.128.182.83:8080
125.253.101.44:8080
68.171.67.0:8081
58.19.164.35:3128
103.18.180.1:8080
123.13.204.151:9999
168.63.20.19:8136
86.61.220.28:8080
187.94.80.37:8080
188.228.144.197:8080
177.72.0.94:8080
113.11.133.204:8080
190.37.57.137:8080
200.69.199.109:8080
113.11.133.203:8080
81.218.132.198:8088
168.63.24.174:8122
58.214.5.229:80
221.237.154.58:9797
103.232.64.195:8080
180.166.55.42:3128
101.230.214.25:8080
180.243.235.40:8080
101.255.60.241:80
115.231.94.34:7777
110.232.78.61:8080
105.112.6.126:8080
103.63.158.130:3128
105.112.6.28:8080
118.96.138.7:8080
66.162.122.24:8080
180.246.109.66:8080
213.159.214.193:80
220.130.196.155:8080
82.80.181.244:8088
188.214.23.99:80
61.7.138.57:8080
139.255.40.202:8081
31.3.190.97:8080
58.52.201.119:8080
103.54.149.65:8080
182.52.104.63:8080
92.222.154.57:3128
213.251.255.138:8080
190.248.136.154:8080
120.136.0.198:8080
150.129.179.154:8080
177.23.137.157:8080
80.240.112.33:8000
115.127.92.134:8080
190.77.182.155:8080
80.240.112.57:8000
213.57.90.253:8080
191.187.250.18:3128
181.198.122.123:8080
112.78.37.194:8080
177.136.113.193:666
80.240.100.33:8000
103.232.64.196:8080
187.44.1.144:8080
168.63.24.174:8118
188.214.23.47:80
223.25.97.196:8080
177.159.113.114:8080
80.240.104.241:8000
85.142.163.1:3128
190.40.101.21:80
189.38.3.9:8080
59.72.122.3:1080
182.253.191.106:8080
103.234.26.14:8080
186.219.36.22:8080
177.39.186.61:3128
182.253.193.34:8080
103.49.189.13:80
189.38.4.217:8080
185.97.123.210:8888
154.73.44.105:8080
222.82.222.242:9999
112.78.37.196:8080
190.202.17.139:3130
222.140.4.8:9797
37.206.231.194:8080
221.193.235.94:9999
168.63.24.174:8120
177.200.102.57:8080
62.176.13.22:8088
103.29.150.14:8080
202.183.32.185:80
202.71.24.17:8080
103.14.27.1:8080
80.240.114.1:8000
177.104.244.130:8080
177.39.160.70:8080
188.214.23.126:80
103.54.149.1:8080
42.157.7.43:9999
188.214.23.76:80
188.214.23.109:80
185.97.123.209:8888
103.28.227.26:8080
217.66.213.190:8080
177.8.163.66:3128
190.122.186.204:8080
103.4.54.73:8080";

            string[] lines = data.Split(new string[] { "\r\n", "\n" }, StringSplitOptions.None);
            int success = 0, failed = 0, skipped = 0;
            foreach(var line in lines)
            {
                string url= "";
                int port = 0;
                try
                {
                    var parts = line.Split(':');
                    url = parts[0];
                    port = Convert.ToInt32(parts[1]);
                    if (port != 80 && port != 8080)
                    {
                        Console.WriteLine("SKIPPING " + url + ":" + port.ToString());
                        skipped++;
                        continue;
                    }

                    using (var context = new MonitorEntities())
                    {
                        var newProxy = new Proxyes()
                        {
                            Id = Guid.NewGuid(),
                            Url = url,
                            Port = port,
                            Status = 0,
                            Ping = -1, 
                            LastUsageTime = null,
                            LastErrorTime = null,
                            LastError = null,
                            UseCount = 0
                        };

                        context.Proxyes.Add(newProxy);
                        context.SaveChanges();

                        success++;
                        Console.WriteLine("=> Added " + url + ":" + port.ToString());
                    }
                }
                catch(Exception e)
                {
                    Console.WriteLine("ERROR " + url + ":" + port.ToString());
                    failed++;
                }
               
            }

            Console.WriteLine("===> Added:" + success.ToString() + " falied:" + failed.ToString() + " skipped:" + skipped.ToString());
            /*try
            {
                using (var client = new WebClientWithTimeout())
                {
                    var proxy = new WebProxy("125.16.240.197", 8080);
                    client.Proxy = proxy;

                    client.Encoding = Encoding.UTF8;
                    client.Headers.Add("User-Agent: Other");
                    var html = client.DownloadString("https://www.airbnb.ru/rooms/10206147");
                    Console.WriteLine(html);
                }

            }
            catch (WebException e)
            {
                Console.WriteLine(e);
            }*/


            Console.ReadLine();
        }
        
    }
}
